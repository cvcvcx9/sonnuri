/*! @name videojs-playlist @version 4.3.0 @license Apache-2.0 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):e.videojsPlaylist=t(e.videojs)}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var t=function(e){var t=e.playlist.autoadvance_;t.timeout&&e.clearTimeout(t.timeout),t.trigger&&e.off("ended",t.trigger),t.timeout=null,t.trigger=null},r=function e(r,n){var i;(t(r),"number"==typeof(i=n)&&!isNaN(i)&&i>=0&&i<1/0)?(r.playlist.autoadvance_.delay=n,r.playlist.autoadvance_.trigger=function(){var i=function(){return e(r,n)};r.one("play",i),r.playlist.autoadvance_.timeout=r.setTimeout(function(){t(r),r.off("play",i),r.playlist.next()},1e3*n)},r.one("ended",r.playlist.autoadvance_.trigger)):r.playlist.autoadvance_.delay=null},n=function(e,t){var n=!e.paused()||e.ended();return e.trigger("beforeplaylistitem",t),e.poster(t.poster||""),e.src(t.sources),function(e){for(var t=e.remoteTextTracks(),r=t&&t.length||0;r--;)e.removeRemoteTextTrack(t[r])}(e),e.ready(function(){if((t.textTracks||[]).forEach(e.addRemoteTextTrack.bind(e)),e.trigger("playlistitem",t),n){var i=e.play();void 0!==i&&"function"==typeof i.then&&i.then(null,function(e){})}r(e,e.playlist.autoadvance_.delay)}),e},i=function(e){return!!e&&"object"==typeof e},a=function(e){var t,r=[];return e.forEach(function(e){i(e)?t=e:(t=Object(e)).originalValue=e,r.push(t)}),r},u=function(e){var t=1;e.forEach(function(e){e.playlistItemId_=t++})},o=function(e,t){for(var r=0;r<e.length;r++)if(e[r].playlistItemId_===t)return r;return-1},l=function(e,t){for(var r=0;r<e.length;r++){var n=e[r].sources;if(Array.isArray(n))for(var i=0;i<n.length;i++){var a=n[i];if(a&&(l=void 0,c=void 0,l=u=a,c=o=t,"object"==typeof u&&(l=u.src),"object"==typeof o&&(c=o.src),/^\/\//.test(l)&&(c=c.slice(c.indexOf("//"))),/^\/\//.test(c)&&(l=l.slice(l.indexOf("//"))),l===c))return r}}var u,o,l,c;return-1},c=function(e){for(var t=-1,r=e.length-1;++t<e.length;){var n=t+Math.floor(Math.random()*(r-t+1)),i=e[n];e[n]=e[t],e[t]=i}return e};var f=function(f,s){!function(f,s,d){void 0===d&&(d=0);var p=null,y=!1,v=f.playlist=function(e,t){if(void 0===t&&(t=0),y)throw new Error("do not call playlist() during a playlist change");if(Array.isArray(e)){var r=Array.isArray(p)?p.slice():null;(p=e.slice()).filter(function(e){return i(e)}).length!==p.length&&(p=a(p)),y=!0,f.trigger({type:"duringplaylistchange",nextIndex:t,nextPlaylist:p,previousIndex:v.currentIndex_,previousPlaylist:r||[]}),y=!1,-1!==t&&v.currentItem(t),r&&f.setTimeout(function(){f.trigger("playlistchange")},0),u(p)}return p.map(function(e){return e.originalValue||e}).slice()};f.on("loadstart",function(){-1===v.currentItem()&&t(f)}),f.on("playlistitem",function(e,t){t&&t.playlistItemId_&&(v.currentPlaylistItemId_=t.playlistItemId_)}),v.currentIndex_=-1,v.player_=f,v.autoadvance_={},v.repeat_=!1,v.currentPlaylistItemId_=null,v.currentItem=function(e){return y?v.currentIndex_:("number"==typeof e&&v.currentIndex_!==e&&e>=0&&e<p.length?(v.currentIndex_=e,n(v.player_,p[v.currentIndex_])):v.currentIndex_=o(p,v.currentPlaylistItemId_),v.currentIndex_)},v.contains=function(e){return-1!==v.indexOf(e)},v.indexOf=function(e){if("string"==typeof e)return l(p,e);for(var t=Array.isArray(e)?e:e.sources,r=0;r<t.length;r++){var n=t[r];if("string"==typeof n)return l(p,n);if(n.src)return l(p,n.src)}return-1},v.currentIndex=function(){return v.currentItem()},v.lastIndex=function(){return p.length-1},v.nextIndex=function(){var e=v.currentItem();if(-1===e)return-1;var t=v.lastIndex();return v.repeat_&&e===t?0:Math.min(e+1,t)},v.previousIndex=function(){var e=v.currentItem();return-1===e?-1:v.repeat_&&0===e?v.lastIndex():Math.max(e-1,0)},v.first=function(){if(!y){var e=v.currentItem(0);if(p.length)return p[e].originalValue||p[e];v.currentIndex_=-1}},v.last=function(){if(!y){var e=v.currentItem(v.lastIndex());if(p.length)return p[e].originalValue||p[e];v.currentIndex_=-1}},v.next=function(){if(!y){var e=v.nextIndex();if(e!==v.currentIndex_){var t=v.currentItem(e);return p[t].originalValue||p[t]}}},v.previous=function(){if(!y){var e=v.previousIndex();if(e!==v.currentIndex_){var t=v.currentItem(e);return p[t].originalValue||p[t]}}},v.autoadvance=function(e){r(v.player_,e)},v.repeat=function(t){return void 0===t?v.repeat_:"boolean"==typeof t?(v.repeat_=!!t,v.repeat_):void e.log.error("videojs-playlist: Invalid value for repeat",t)},v.sort=function(e){p.length&&(p.sort(e),y||f.trigger("playlistsorted"))},v.reverse=function(){p.length&&(p.reverse(),y||f.trigger("playlistsorted"))},v.shuffle=function(e){var t,r=(void 0===e?{}:e).rest,n=0,i=p;(r&&(n=v.currentIndex_+1,i=p.slice(n)),i.length<=1)||(c(i),r&&(t=p).splice.apply(t,[n,i.length].concat(i)),y||f.trigger("playlistsorted"))},Array.isArray(s)?v(s.slice(),d):p=[]}(this,f,s)};return(e.registerPlugin||e.plugin)("playlist",f),f.VERSION="4.3.0",f});
